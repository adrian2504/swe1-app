language: python
python:
  - "3.12"

env:
  global:
    - DJANGO_SETTINGS_MODULE=mysite.settings
    - AWS_DEFAULT_REGION=us-east-1
    - PORT=8000

install:
  - pip install -r requirements.txt
  - pip install black flake8 coverage coveralls awsebcli python-dotenv

before_script:
  # Run Black formatter check
  - black --check .
  # Run Flake8 linter
  - flake8 --max-line-length=88
  # Run Django checks (migrations, etc.)
  - python manage.py check

script:
  # Run Django tests with coverage
  - coverage run manage.py test
  - coverage report

after_success:
  - coveralls

deploy:
  provider: elasticbeanstalk
  region: "us-east-1"
  app: "adrian-djangoapp"                # ğŸ” your EB application name
  env: "adrian-django-env"               # ğŸ” your EB environment name
  bucket_name: "elasticbeanstalk-us-east-1-503561431144"  # ğŸ” your EB S3 bucket
  on:
    branch: main
  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
